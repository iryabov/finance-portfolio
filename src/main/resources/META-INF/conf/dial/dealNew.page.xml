<?xml version='1.0' encoding='UTF-8'?>
<simple-page xmlns="http://n2oapp.net/framework/config/schema/page-2.0"
             name="New deal">
    <form object-id="deal">
        <fields>
            <date-time id="opened" label="Opened" required="true" default-value="{moment().format('YYYY-MM-DD')}"/>
            <radio-group id="type" label="Deal type" param="type"
                    required="true" inline="true">
                <default-value id="PURCHASE"/>
                <options>
                    <option id="PURCHASE" name="Purchase"/>
                    <option id="SALE" name="Sale"/>
                    <option id="DEPOSIT" name="Deposit"/>
                    <option id="WITHDRAWALS" name="Withdrawals"/>
                    <option id="DIVIDEND" name="Dividend"/>
                    <option id="TAX" name="Tax"/>
                </options>
            </radio-group>
<!--            <output-text id="account.id" param="account_id"/>-->
<!--            <input-select id="asset" label="Asset" query-id="assets" label-field-id="fullName">-->
<!--                -->
<!--            </input-select> -->
            <auto-complete id="asset.id" label="Ticker" param="asset_id"
                           query-id="security" value-field-id="id"
                           search-filter-id="ticker"
                           required="true">
            </auto-complete>
            
            <radio-group id="currency" label="Currency" required="true" inline="true">
                <default-value id="RUB"/>
                <options>
                    <option id="RUB" name="RUB"/>
                    <option id="USD" name="USD"/>
                    <option id="EUR" name="EUR"/>
                </options>
            </radio-group>
            <set>
                <input-money id="volume" label="Volume" required="true">
                </input-money>
                <input-text id="quantity" label="Quantity" required="true" domain="integer" min="0">
                    <dependencies>
                        <visibility on="type">type.id != 'DEPOSIT'
                            &amp;&amp; type.id != 'WITHDRAWALS'
                            &amp;&amp; type.id != 'TAX'
                            &amp;&amp; type.id != 'DIVIDEND'</visibility>
                    </dependencies>
                </input-text>
                <output-text id="price" label="Price" format="number 1.0">
                    <dependencies>
                        <set-value apply-on-init="false" on="volume,quantity">volume / quantity</set-value>
                        <visibility on="type">type.id != 'DEPOSIT'
                            &amp;&amp; type.id != 'WITHDRAWALS'
                            &amp;&amp; type.id != 'TAX'
                            &amp;&amp; type.id != 'DIVIDEND'</visibility>
                    </dependencies>
                </output-text>
                <select id="accountTo" param="account_to" label="Remittance to account" query-id="accounts" label-field-id="name">
                    <dependencies>
                        <visibility on="type">type.id == 'DEPOSIT' ||
                            type.id == 'WITHDRAWALS' ||
                            type.id == 'DIVIDEND' ||
                            type.id == 'COUPON' ||
                            type.id == 'PERCENT'</visibility>
                    </dependencies>
                </select>
            </set>
        </fields>
    </form>
</simple-page>
